<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pro Quiz Game</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f2f2f2;
      transition: background 0.3s, color 0.3s;
    }
    .dark-mode {
      background-color: #121212;
      color: #f5f5f5;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
      margin-top: 20px;
      transition: background 0.3s;
    }
    .dark-mode .card {
      background: #1e1e1e;
    }
    .question {
      font-size: 1.2rem;
      margin-bottom: 15px;
    }
    button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 12px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .btn-answer { background: #eee; }
    .btn-answer:hover { background: #ddd; }
    .btn-correct { background-color: #4caf50 !important; color: white; }
    .btn-wrong { background-color: #f44336 !important; color: white; }
    .btn-primary {
      background: #2196f3;
      color: white;
    }
    .btn-toggle {
      background: #555;
      color: white;
      margin-top: 10px;
    }
    .progress {
      height: 10px;
      background: #ddd;
      border-radius: 6px;
      overflow: hidden;
      margin-top: 10px;
    }
    .progress-bar {
      height: 10px;
      background: #2196f3;
      width: 0;
      transition: width 0.3s;
    }
    .info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    @media (max-width: 500px) {
      .question { font-size: 1rem; }
    }
  </style>
</head>
<body>
<div class="container">
  <h1>LET'S PLAY ONLINE QUIZ</h1>
  <select id="category-select"></select>
  <select id="difficulty-select">
    <option value="easy">Easy</option>
    <option value="medium">Medium</option>
    <option value="hard">Hard</option>
  </select>
  <button id="start-btn" class="btn-primary">Start Quiz</button>
  <button id="toggle-theme" class="btn-toggle">Toggle Dark Mode</button>

  <div id="quiz" class="card" style="display:none;">
    <div class="info">
      <span>Score: <span id="score">0</span></span>
      <span>Question <span id="current">1</span></span>
    </div>
    <div class="progress"><div id="progress-bar" class="progress-bar"></div></div>
    <div id="question" class="question">Question text</div>
    <div id="answers"></div>
    <button id="next-btn" class="btn-primary" style="display:none;">Next</button>
    <button id="restart-btn" class="btn-primary" style="display:none;">Restart</button>
  </div>

  <div id="summary" class="card" style="display:none;">
    <h2>Quiz Completed!</h2>
    <p>Your Score: <span id="final-score"></span></p>
    <p>High Score: <span id="high-score"></span></p>
    <button id="play-again-btn" class="btn-primary">Play Again</button>
  </div>
</div>

<script>
const categorySelect = document.getElementById('category-select');
const difficultySelect = document.getElementById('difficulty-select');
const startBtn = document.getElementById('start-btn');
const toggleThemeBtn = document.getElementById('toggle-theme');
const quiz = document.getElementById('quiz');
const questionEl = document.getElementById('question');
const answersEl = document.getElementById('answers');
const nextBtn = document.getElementById('next-btn');
const restartBtn = document.getElementById('restart-btn');
const scoreEl = document.getElementById('score');
const currentEl = document.getElementById('current');
const progressBar = document.getElementById('progress-bar');
const summary = document.getElementById('summary');
const finalScore = document.getElementById('final-score');
const highScoreEl = document.getElementById('high-score');
const playAgainBtn = document.getElementById('play-again-btn');

let questions = [], currentQuestion = {}, score = 0, questionCount = 0, correctAnswer = '', token = '';

async function getToken() {
  const res = await fetch('https://opentdb.com/api_token.php?command=request');
  const data = await res.json();
  token = data.token;
}

async function loadCategories() {
  const res = await fetch('https://opentdb.com/api_category.php');
  const data = await res.json();
  categorySelect.innerHTML = data.trivia_categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('');
}

function decode(text) {
  const txt = document.createElement('textarea');
  txt.innerHTML = text;
  return txt.value;
}

async function getQuestion() {
  const category = categorySelect.value;
  const difficulty = difficultySelect.value;
  const res = await fetch(`https://opentdb.com/api.php?amount=1&category=${category}&difficulty=${difficulty}&type=multiple&token=${token}`);
  const data = await res.json();
  if (data.response_code === 4) {
    await fetch(`https://opentdb.com/api_token.php?command=reset&token=${token}`);
    return getQuestion();
  }
  currentQuestion = data.results[0];
  correctAnswer = decode(currentQuestion.correct_answer);
  const options = [...currentQuestion.incorrect_answers.map(decode), correctAnswer].sort(() => Math.random() - 0.5);
  showQuestion(decode(currentQuestion.question), options);
}

function showQuestion(question, options) {
  questionEl.textContent = question;
  answersEl.innerHTML = '';
  options.forEach(option => {
    const btn = document.createElement('button');
    btn.textContent = option;
    btn.classList.add('btn-answer');
    btn.onclick = () => selectAnswer(btn);
    answersEl.appendChild(btn);
  });
  nextBtn.style.display = 'none';
  restartBtn.style.display = 'none';
}

function selectAnswer(btn) {
  const buttons = document.querySelectorAll('.btn-answer');
  buttons.forEach(b => {
    b.disabled = true;
    if (b.textContent === correctAnswer) b.classList.add('btn-correct');
    else if (b === btn) b.classList.add('btn-wrong');
  });
  if (btn.textContent === correctAnswer) score++;
  scoreEl.textContent = score;
  nextBtn.style.display = 'block';
  restartBtn.style.display = 'block';
}

function updateProgress() {
  currentEl.textContent = questionCount;
  progressBar.style.width = `${(questionCount % 10) * 10}%`;
}

function showSummary() {
  quiz.style.display = 'none';
  summary.style.display = 'block';
  finalScore.textContent = score;
  const highScore = Math.max(score, localStorage.getItem('highScore') || 0);
  localStorage.setItem('highScore', highScore);
  highScoreEl.textContent = highScore;
}

startBtn.onclick = () => {
  score = 0;
  questionCount = 1;
  scoreEl.textContent = score;
  currentEl.textContent = questionCount;
  summary.style.display = 'none';
  quiz.style.display = 'block';
  getQuestion();
};

nextBtn.onclick = () => {
  questionCount++;
  updateProgress();
  getQuestion();
};

restartBtn.onclick = () => {
  score = 0;
  questionCount = 1;
  scoreEl.textContent = score;
  currentEl.textContent = questionCount;
  updateProgress();
  getQuestion();
};

playAgainBtn.onclick = () => {
  score = 0;
  questionCount = 1;
  summary.style.display = 'none';
  quiz.style.display = 'block';
  getQuestion();
};

toggleThemeBtn.onclick = () => {
  document.body.classList.toggle('dark-mode');
};

getToken().then(loadCategories);
</script>
</body>
</html>